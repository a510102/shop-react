{"version":3,"sources":["components/CheckOut.js","components/ShopCart/ShopCart.js"],"names":["CheckOut","alert","useAlert","useState","user","message","order","setOrder","id","setId","pay","setPay","done","setDone","handleChange","event","target","name","value","preOrder","a","newOrder","fetch","method","body","JSON","stringify","data","headers","response","json","datas","success","orderId","error","Url","show","htmlFor","type","onChange","onClick","ShopCart","history","useHistory","useContext","ShopContext","carts","cartDispatch","coupon","setCoupon","open","setOpen","loading","setLoading","fetchData","cart","result","text","code","price","final_total","useEffect","className","length","map","i","key","product","title","qty","unit","total","handleDeleCart","placeholder","handleCoupon","push"],"mappings":"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","file":"static/js/12.30e53742.chunk.js","sourcesContent":["import React, { useState } from 'react'\r\nimport { useAlert } from 'react-alert';\r\n\r\n\r\nexport default function CheckOut() {\r\n  const alert = useAlert();\r\n  const [order, setOrder] = useState({\r\n    user: {},\r\n    message: ''\r\n  });\r\n  const [id, setId] = useState(null);\r\n  const [pay, setPay] = useState(false);\r\n  const [done, setDone] = useState(false);\r\n\r\n  function handleChange(event) {\r\n    const { name, value } = event.target;\r\n    setOrder(preOrder => {\r\n      if (name === 'message') {\r\n        return {\r\n          ...preOrder,\r\n          [name]: value\r\n        }\r\n      } else {\r\n        return {\r\n          ...preOrder,\r\n          user: {\r\n            ...preOrder.user,\r\n            [name]: value\r\n          }\r\n        }\r\n      }\r\n    })\r\n  }\r\n\r\n  async function AddOrder() {\r\n    const Url = 'https://vue-course-api.hexschool.io/api/jay/order';\r\n    let newOrder;\r\n    if (!order.message) {\r\n      newOrder = {\r\n        ...order,\r\n        message: '無'\r\n      };\r\n    } else {\r\n      newOrder = { ...order };\r\n    }\r\n    const response = await fetch(Url, {\r\n      method: 'POST',\r\n      body: JSON.stringify({ data: { ...newOrder } }),\r\n      headers: { 'content-type': 'application/json' }\r\n    });\r\n    const datas = await response.json();\r\n    const { success, orderId, message } = datas;\r\n\r\n    if (success) {\r\n      setId(orderId);\r\n      alert.success(message);\r\n      setPay(true);\r\n    } else {\r\n      alert.error(message);\r\n    }\r\n  }\r\n\r\n  async function handlePay() {\r\n    const Url = `https://vue-course-api.hexschool.io/api/jay/pay/${id}`;\r\n    const response = await fetch(Url, { method: 'POST' });\r\n    const datas = await response.json();\r\n    const { success, message } = datas;\r\n\r\n    if (success) {\r\n      alert.show(message);\r\n      setDone(true);\r\n    }\r\n  }\r\n\r\n  return (\r\n    <div>\r\n      {!done ? (<>\r\n        <div>\r\n          <h2>客戶資訊</h2>\r\n          <label htmlFor='name'>姓名:\r\n          <input\r\n              type='string'\r\n              name='name'\r\n              id='id'\r\n              onChange={handleChange} />\r\n          </label>\r\n          <label htmlFor='address'>地址:\r\n          <input\r\n              type='string'\r\n              name='address'\r\n              id='address'\r\n              onChange={handleChange} />\r\n          </label>\r\n          <label htmlFor='tel'>電話:\r\n          <input\r\n              type='number'\r\n              name='tel'\r\n              id='tel'\r\n              onChange={handleChange} />\r\n          </label>\r\n          <label htmlFor='email'>E-mail:\r\n          <input\r\n              type='email'\r\n              name='email'\r\n              id='email'\r\n              onChange={handleChange} />\r\n          </label>\r\n          <label htmlFor='message'>Message:\r\n          <input\r\n              type='message'\r\n              name='message'\r\n              id='message'\r\n              onChange={handleChange} />\r\n          </label>\r\n          {\r\n            !pay ? <button onClick={AddOrder}>完成訂單</button> : <button onClick={handlePay}>確認結帳</button>\r\n          }\r\n        </div>\r\n      </>) : <div>購物完成!</div>\r\n      }\r\n    </div>\r\n  )\r\n}","import React, { useState, useEffect, useContext } from 'react';\r\nimport { useAlert } from 'react-alert'\r\nimport { ShopContext } from '../../contexts/shopCartContext/ShopCartContext';\r\nimport { useHistory } from 'react-router-dom'\r\nimport CheckOut from '../CheckOut';\r\n\r\nexport default function ShopCart() {\r\n    const alert = useAlert();\r\n    const history = useHistory();\r\n\r\n    const { carts, cartDispatch } = useContext(ShopContext);\r\n    const [coupon, setCoupon] = useState('');\r\n    const [open, setOpen] = useState(false);\r\n    const [loading, setLoading] = useState(true);\r\n\r\n    useEffect(() => {\r\n        fetchData();\r\n        // eslint-disable-next-line react-hooks/exhaustive-deps\r\n    }, []);\r\n\r\n    async function fetchData() {\r\n        const Url = 'https://vue-course-api.hexschool.io/api/jay/cart';\r\n        const response = await fetch(Url);\r\n        const datas = await response.json();\r\n        if (datas.success) {\r\n            cartDispatch({ type: \"UPDATE_CART\", cart: datas.data })\r\n            setLoading(false);\r\n        }\r\n    }\r\n\r\n    async function handleDeleCart(id) {\r\n        const Url = `https://vue-course-api.hexschool.io/api/jay/cart/${id}`;\r\n        const response = await fetch(Url, { method: \"DELETE\" });\r\n        const result = await response.json();\r\n        const { success, message } = result;\r\n        if (success) {\r\n            fetchData();\r\n            alert.success(message)\r\n        }\r\n    }\r\n\r\n    function handleChange(event) {\r\n        const value = event.target.value;\r\n        setCoupon(value);\r\n    }\r\n\r\n    async function handleCoupon(text) {\r\n        const Url = 'https://vue-course-api.hexschool.io/api/jay/coupon';\r\n        const data = { data: { code: text } }\r\n        const response = await fetch(Url, { method: 'POST', body: JSON.stringify(data), headers: { 'content-type': 'application/json' } });\r\n        const result = await response.json();\r\n\r\n        const { success, message } = result;\r\n\r\n        if (success) {\r\n            cartDispatch({ type: \"UPDATE_PRICE\", price: result.data.final_total });\r\n            alert.success(message);\r\n        } else {\r\n            alert.error(message);\r\n        }\r\n    };\r\n\r\n    function handleCheckOut() {\r\n        setOpen(true);\r\n    }\r\n\r\n    return (\r\n        <div className='my-4 mx-auto p-2 text-right'>\r\n            {\r\n                !loading && (\r\n                    <ul className='w-full'>\r\n                        {\r\n                            !carts.carts.length ? <h3>nothings</h3> : (\r\n                                <>\r\n                                    {carts.carts.map((cart, i) => {\r\n                                        return (\r\n                                            <li\r\n                                                className='ml-auto p-2 flex w-3/4 lg:w-1/2 border-b-2 items-center justify-between border-gray-600'\r\n                                                key={i}>\r\n                                                <p className='flex'>\r\n                                                    <span>{cart.product.title}{cart.qty} {cart.product.unit}</span>\r\n                                                    <span className='ml-4'>{cart.total} 元</span> </p>\r\n                                                <button\r\n                                                    className='bg-red-500 hover:bg-red-600 text-white font-bold py-1 px-2 rounded-full'\r\n                                                    onClick={() => handleDeleCart(cart.id)}>刪除</button>\r\n                                            </li>\r\n                                        )\r\n                                    })}\r\n                                    <li className='p-2'>總共: {carts.final_total} 元</li>\r\n                                    <li className='p-2'>\r\n                                        <input className='p-2 text-indigo-400 border border-teal-400 rounded-md' onChange={handleChange}\r\n                                            placeholder='輸入優惠卷代碼'\r\n                                            value={coupon || ''} />\r\n                                        <button\r\n                                            className='ml-2 bg-indigo-400 hover:bg-indigo-600 text-white font-bold py-1 px-2 rounded-full'\r\n                                            onClick={() => handleCoupon(coupon)}>優惠</button>\r\n                                    </li>\r\n                                    {\r\n                                        open && <CheckOut />\r\n                                    }\r\n                                    {\r\n                                        !open && <button\r\n                                            className='mr-2 mt-2 bg-teal-400 hover:bg-teal-600 text-white font-bold py-1 px-2 rounded-full'\r\n                                            onClick={handleCheckOut}>前往結帳</button>\r\n                                    }\r\n                                </>\r\n                            )\r\n                        }\r\n                        <button\r\n                            className='bg-blue-400 hover:bg-blue-600 text-white font-bold py-1 px-2 rounded-full'\r\n                            onClick={() => { history.push('/shop-react/shop') }}>返回</button>\r\n                    </ul>\r\n                )\r\n            }\r\n        </div >\r\n    )\r\n}"],"sourceRoot":""}